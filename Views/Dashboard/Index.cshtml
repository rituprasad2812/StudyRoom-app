@model StudyRoom.Controllers.DashboardViewModel
@using System.Text.Json
@using System.Linq

@{
ViewData["Title"] = "Dashboard";
var labelsJson = JsonSerializer.Serialize(Model.Labels ?? new List<string>());
var valuesJson = JsonSerializer.Serialize(Model.Values ?? new List<int>());
}

<h2 class="mb-4">Your Study Dashboard</h2><div class="row g-3 mb-4"> <div class="col-md-4"> <div class="card text-center"> <div class="card-body"> <div class="display-6">@Model.TotalWeekMinutes</div> <div class="text-muted">Minutes (Last 7 Days)</div> </div> </div> </div> <div class="col-md-4"> <div class="card text-center"> <div class="card-body"> <div class="display-6">@Model.TotalMonthMinutes</div> <div class="text-muted">Minutes (Last 30 Days)</div> </div> </div> </div> <div class="col-md-4"> <div class="card text-center"> <div class="card-body"> <div class="display-6">@Model.StreakDays</div> <div class="text-muted">Day Streak</div> </div> </div> </div> </div><div class="card mb-4"> <div class="card-header">Last 30 Days</div> <div class="card-body"> <canvas id="dailyChart" height="100"></canvas> </div> </div><div class="row g-3"> <div class="col-md-6"> <div class="card h-100"> <div class="card-header">Leaderboard (This Week)</div> <div class="card-body"> <ol class="mb-0"> @foreach (var e in Model.WeekLeaders) { <li>@e.UserName <span class="text-muted">— @e.Minutes min</span></li> } @if (!Model.WeekLeaders.Any()) { <div class="text-muted">No data yet.</div> } </ol> </div> </div> </div> <div class="col-md-6"> <div class="card h-100"> <div class="card-header">Leaderboard (This Month)</div> <div class="card-body"> <ol class="mb-0"> @foreach (var e in Model.MonthLeaders) { <li>@e.UserName <span class="text-muted">— @e.Minutes min</span></li> } @if (!Model.MonthLeaders.Any()) { <div class="text-muted">No data yet.</div> } </ol> </div> </div> </div> </div>
@if (Model.Badges.Any())
{
<div class="card mt-4">
<div class="card-header">Your Badges</div>
<div class="card-body d-flex flex-wrap gap-2">
@foreach (var b in Model.Badges)
{
<span class="badge rounded-pill bg-success">
<span style="font-size:1.1rem;">@b.Icon</span>
<strong class="ms-1">@b.Name</strong>
</span>
}
</div>
</div>
}

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Server-provided JSON
const labels = @Html.Raw(labelsJson);
const data = @Html.Raw(valuesJson);
    // Draw chart when canvas exists and Chart is loaded
    const canvas = document.getElementById('dailyChart');
    if (canvas && typeof Chart !== 'undefined') {
        const ctx = canvas.getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Minutes',
                    data: data,
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13,110,253,0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                scales: { y: { beginAtZero: true } },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    } else {
        console.warn('Chart.js not loaded or canvas missing.');
    }
</script>
}